---
title: "StoreKit2ã®å¤‰æ›´ç‚¹ã¾ã¨ã‚"
emoji: "ğŸ’¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [ios, storekit, xcode, wwdc22]
published: true
---

StoreKit2ã«ã¤ã„ã¦ã¾ã¨ã‚ã¾ã—ãŸã€‚
å¾“æ¥ã®StoreKitã‹ã‚‰ã®å¤‰æ›´ç‚¹ã‚’ä¸»ã¨ã—ã¦ãŠã‚Šã€ã‚¢ãƒ—ãƒªå†…èª²é‡‘ã®å®Ÿè£…æ–¹æ³•ã«ã¤ã„ã¦ã®èª¬æ˜ã¯å‰²æ„›ã—ã¦ã„ã¾ã™ã€‚

## Product
å•†å“æƒ…å ±&è³¼èª­å‡¦ç†ã‚’æŒã¤Struct
https://developer.apple.com/documentation/storekit/product

1ãƒ¡ã‚½ãƒƒãƒ‰ã§å•†å“æƒ…å ±ã®å–å¾—ãŒå¯èƒ½

```swift
let products: [Product] = try await Product.products(for: <# ProductIdã®é…åˆ— #>)
```

Productã«ã¯ã€ä¸‹è¨˜ã®ã‚ˆã†ãªæ¬²ã—ã‹ã£ãŸæƒ…å ±ãŒç¶²ç¾…ã•ã‚Œã¦ã„ã‚‹
* `type: Product.ProductType`
    * consumable, autoRenewableãªã©èª²é‡‘ã‚¿ã‚¤ãƒ—ã®enumã€‚è¤‡æ•°ã®èª²é‡‘ã‚¿ã‚¤ãƒ—ã‚’æŒã¤ã‚¢ãƒ—ãƒªã§æ´»ç”¨ã§ãã‚‹
* `displayPrice: String`
    * ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºæ¸ˆã¿ã®ä¾¡æ ¼è¡¨è¨˜(ex. ï¿¥360, $4.99)
* `displayName: String`
    * å•†å“å

## Purchase
https://developer.apple.com/documentation/storekit/product/3791971-purchase

* è³¼èª­å‡¦ç†ã‚’async/awaitã§å®Ÿè¡Œã§ãã‚‹ `try await product.purchase()`
* æ—§StoreKitæ™‚ä»£ã®ã‚ˆã†ã«PaymentQueueã®delegateå†…ã§finishTransactionã—ãªãã¦ã‚‚ã‚ˆãã€1ãƒ¡ã‚½ãƒƒãƒ‰ã§å…¨ã¦ã®å‡¦ç†ã‚’å®Œçµã§ãã‚‹
* appAccountTokenã‚’optionã¨ã—ã¦å«ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹(å¾Œè¿°)

```swift
// appAccountTokenã‚’ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«å«ã‚ã¦è³¼èª­ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
let appAccountToken = <# Generate an app account token. #>
let purchaseResult = try await product.purchase(options: [
    .appAccountToken(appAccountToken)
])
```

### StoreKit2ãŒãƒ¬ã‚·ãƒ¼ãƒˆæ¤œè¨¼ã¾ã§ã‚„ã£ã¦ãã‚Œã‚‹
* StoreKit2ã§ã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã«JWSãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã€ãƒ¬ã‚·ãƒ¼ãƒˆæ¤œè¨¼ãƒ—ãƒ­ã‚»ã‚¹ã‚’é€šéã—ã¦AppStoreã«ã‚ˆã£ã¦ç½²åæ¸ˆã¿ã®ç«¯æœ«ã‹ã©ã†ã‹ç¢ºèªã—ã¦ãã‚Œã‚‹
* çµæœã¯`product.purchase()`ã®è¿”ã‚Šå€¤ã¨ã—ã¦è¿”å´ã•ã‚Œã‚‹
https://developer.apple.com/videos/play/wwdc2021/10114/?time=685

### è³¼èª­æ™‚ã®ã‚µãƒ³ãƒ—ãƒ«
* `product.purchase()`ã®è¿”ã‚Šå€¤ã¯enumã§è¿”ã£ã¦ãã‚‹
    * .success(VerificationResult<Transaction>), .pending, .userCancelled
* `.success(let verificationResult)` ã®verificationResultã‹ã‚‰ãƒ¬ã‚·ãƒ¼ãƒˆæ¤œè¨¼ã®çµæœã‚’å–å¾—ã§ãã‚‹
    * è³¼èª­çµæœãŒã€`.verified`ãªå ´åˆã€Transactionã‹ã‚‰è³¼èª­çµæœã®æƒ…å ±ã‚’å–å¾—ã§ãã€`transaction.finish()`ã§è³¼èª­ã‚’å®Œäº†ã§ãã‚‹
    * è³¼èª­çµæœãŒã€`.unverified` ãªå ´åˆã¯è³¼èª­å‡¦ç†ã¯æˆåŠŸã—ãŸãŒã€ãƒ¬ã‚·ãƒ¼ãƒˆæ¤œè¨¼ãŒå¤±æ•—ã—ãŸã‚±ãƒ¼ã‚¹ã§ã€ãã®æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ãŒè¿”ã£ã¦ãã‚‹
    * æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ä¸€è¦§ https://developer.apple.com/documentation/storekit/verificationresult/verificationerror#3875816
* throwã•ã‚Œã‚‹ã‚¨ãƒ©ãƒ¼ã¯ `Product.PurchaseError` or `StoreKitError`


```swift
let result = try await product.purchase()
switch result {
case .success(let verificationResult):
    switch verificationResult {
    case .verified(let transaction):
        // Give the user access to purchased content.
        ...
        // Complete the transaction after providing
        // the user access to the content.
        // è³¼èª­å‡¦ç†ã®æˆ»ã‚Šå€¤ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’finish()ã§ãã‚‹ã®ä¾¿åˆ©ï¼
        await transaction.finish()
    case .unverified(let transaction, let verificationError):
        // Handle unverified transactions based 
        // on your business model.
        ...
    }
case .pending:
    // The purchase requires action from the customer. 
    // If the transaction completes, 
    // it's available through Transaction.updates.
    break
case .userCancelled:
    // The user canceled the purchase.
    break
@unknown default:
    break
}
```

## Transaction (æ—§SKPaymentTransaction)
https://developer.apple.com/documentation/storekit/transaction

å‰æã¨ã—ã¦ã€
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³¼èª­ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å¤‰æ›´, ã‚¢ãƒ—ãƒªå¤–ã§ã®è³¼èª­(AppStoreã®è¨­å®šç”»é¢ãªã©), pendingçŠ¶æ…‹ã®è³¼èª­å‡¦ç†ã‚’ç›£è¦–ã™ã‚‹ãŸã‚ã€ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«Transactionã‚’listenã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚(æ—§SKPaymentTransactionåŒæ§˜)

`Transaction.updates` ã«AsyncSequenceãŒæµã‚Œã‚‹ã®ã§ã€ãã‚Œã‚’ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«listenã™ã‚‹
Task(priority: .background)ã‚„Task.detachedã§ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰å¤–ã§å‡¦ç†ã™ã‚‹

**ã‚¢ãƒ—ãƒªå†…ã§è³¼èª­ã—ãŸæ™‚ã¯TransactionãŒæµã‚Œãªã„**
ã“ã‚ŒãŒç´ æ™´ã‚‰ã—ã„ã€‚ä»¥å‰ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè³¼èª­ã—ãŸéš›ã‚‚å•ç­”ç„¡ç”¨ã§SKPaymentQueueã«TransactionãŒæµã‚Œã¦ã„ãŸã®ã§è€ƒæ…®ãŒå¿…è¦ã ã£ãŸ
â€»è³¼èª­æ™‚ã®Transactionã¯`try await product.purchase()`ãƒ¡ã‚½ãƒƒãƒ‰ã®æˆ»ã‚Šå€¤ã§å–å¾—ã§ãã‚‹

``` swift
// ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ã€AppDelegateã‚„SwiftUIãªã‚‰RootãªViewãªã©ã§ã“ã®classã‚’ä¿æŒã—ã€
// Transactionã‚’listenã—ç¶šã‘ã‚‹
final class TransactionObserver {
    var updates: Task<Void, Never>? = nil
    
    init() {
        updates = newTransactionListenerTask()
    }

    deinit {
        // Cancel the update handling task when you deinitialize the class.
        updates?.cancel()
    }
    
    private func newTransactionListenerTask() -> Task<Void, Never> {
        Task(priority: .background) {
            for await verificationResult in Transaction.updates {
                self.handle(updatedTransaction: verificationResult)
            }
        }
    }
    
    private func handle(updatedTransaction verificationResult: VerificationResult<Transaction>) {
        guard case .verified(let transaction) = verificationResult else {
            // Ignore unverified transactions.
            return
        }

        if let revocationDate = transaction.revocationDate {
            // Remove access to the product identified by transaction.productID.
            // Transaction.revocationReason provides details about
            // the revoked transaction.
            <#...#>
        } else if let expirationDate = transaction.expirationDate,
            expirationDate < Date() {
            // Do nothing, this subscription is expired.
            return
        } else if transaction.isUpgraded {
            // Do nothing, there is an active transaction
            // for a higher level of service.
            return
        } else {
            // Provide access to the product identified by
            // transaction.productID.
            <#...#>
        }
    }   
}
```

#### iOS16~
`transaction.environment` ã‹ã‚‰AppStoreã®ç’°å¢ƒã‚’åˆ¤å®šã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸ
Xcodeã‹ã‚‰å®Ÿè¡Œã—ãŸå ´åˆã€ã‚µãƒ¼ãƒãƒ¼ã®ãƒ¬ã‚·ãƒ¼ãƒˆæ¤œè¨¼ã‚’skip, ã‚³ãƒ³ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’è¨ˆæ¸¬ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’skipãªã©ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå¯èƒ½ã«ãªã£ã¦ã„ã‚‹

``` swift
if transaction.environment == .xcode {
    // storekit.configã‚’ä½¿ã£ã¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ãƒ‡ãƒãƒƒã‚°ã—ã¦ã„ã‚‹å ´åˆã®å‡¦ç†
}
```

## Subscription status
å–å¼•å±¥æ­´ã®ä»–ã«ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å–å¾—ã§ãã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚‚Productã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹
TransactionåŒæ§˜ã€JWSã§æš—å·åŒ–ã•ã‚Œã¦ãŠã‚Šã‚»ã‚­ãƒ¥ã‚¢
https://developer.apple.com/videos/play/wwdc2021/10114/?time=1358

ä¸‹è¨˜ã®æƒ…å ±ãŒå–å¾—ã§ãã‚‹
https://developer.apple.com/documentation/storekit/product
* Latest transaction: æœ€æ–°ã®è³¼èª­æƒ…å ±
* Renewal state: å¥‘ç´„ä¸­ã€æœŸé™åˆ‡ã‚Œã€çŒ¶äºˆæœŸé–“ã‹ãªã©è³¼èª­ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
* Renewal info: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ±ã®ä»–ã«è‡ªå‹•æ›´æ–°ã—ã¦ã„ã‚‹product ID, æœŸé™åˆ‡ã‚Œã®ç†ç”±ãªã©å…¨ã¦ã®æƒ…å ±

`Product.SubscriptionInfo.RenewalState` ã‚’ç”¨ã„ã¦Stateã«å¿œã˜ãŸã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¯èƒ½
`expired`ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å‘ã‘ã¦ã€å‰²å¼•ã‚ªãƒ•ã‚¡ãƒ¼ã‚’å‡ºã™ãªã©
```swift
// Product.SubscriptionInfo.RenewalStateã§åˆ¤å®šã§ãã‚‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
public static let subscribed: Product.SubscriptionInfo.RenewalState
public static let expired: Product.SubscriptionInfo.RenewalState
public static let inBillingRetryPeriod: Product.SubscriptionInfo.RenewalState
public static let inGracePeriod: Product.SubscriptionInfo.RenewalState
public static let revoked: Product.SubscriptionInfo.RenewalState
```

## ãƒªã‚¹ãƒˆã‚¢å‡¦ç†
restoreCompletedTransactionsã®ãƒ‡ãƒªã‚²ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹ãƒªã‚¹ãƒˆã‚¢æ™‚ã®å‡¦ç†ã¨ã—ã¦AppStore.sync()ãŒç”¨æ„ã•ã‚Œã¦ã„ã‚‹
**å†èªè¨¼(ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›)ãŒå¿…è¦ã«ãªã£ãŸ**
https://developer.apple.com/documentation/storekit/appstore/3791906-sync

"Transactionã‚’ç”¨ã„ã‚Œã°é€šå¸¸å‘¼ã³å‡ºã™å¿…è¦ãŒãªã„å‡¦ç†"ã¨ã—ã¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹
ã‚ãã¾ã§Transaction.updatesã‚’è³¼èª­ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã™ã‚‹ã“ã¨ã‚’ãƒªã‚¹ãƒˆã‚¢ã®ä¸»ã¨ã—ã€å¼·åˆ¶çš„ã«å¾©å…ƒã•ã›ã‚‹ã‚µãƒ–ã¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰‹å‹•ã®å¾©å…ƒãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã—ã¦ãŠãã®ãŒãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã€‚

å¼•ç”¨)
> In regular operations, thereâ€™s no need to call sync(). StoreKit automatically keeps up to date transaction information and subscription status available to your app. When users reinstall your app or download it on a new device, the app automatically has all transactions available to it upon initial launch. Thereâ€™s no need for users to ask your app to restore transactions â€” your app can immediately get the current entitlements using currentEntitlements and transaction history using all. For more information about transactions, see Transaction.

"(Transactionã®è‡ªå‹•åŒæœŸã§å¤§åŠã®ã‚±ãƒ¼ã‚¹ãŒã‚«ãƒãƒ¼ã•ã‚Œã‚‹ã®ã§)ã‚ã¾ã‚Šä½¿ã†ã“ã¨ã¯ãªã„ãŒã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåˆ¥ã®AppleIDã‚’ä½¿ç”¨ã—ãŸå ´åˆãªã©ã«å¼·åˆ¶çš„ã«å¾©å…ƒã•ã›ã‚‹ãŸã‚ã€ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã¨ã—ã¦å¾©å…ƒãƒœã‚¿ãƒ³ã‚’ç½®ã„ãŸæ–¹ãŒè‰¯ã„"
[Implement proactive in-app purchase restore](https://developer.apple.com/videos/play/wwdc2022/110404/?time=1145)

## App account token
Product.purchaseã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦ä»˜ä¸ã—ãŸå ´åˆã€Transactionã§è³¼èª­å±¥æ­´ã‚’å–å¾—ã—ãŸã¨ãã«è³¼èª­çµæœã«åŒã˜appAccountTokenã‚’StoreKitå´ã‹ã‚‰ä»˜ä¸ã—ã¦ãã‚Œã‚‹
Appã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã”ã¨ã«appAccountTokenã‚’ä¿å­˜ã—ã¦ãŠãã¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã”ã¨ã®è³¼èª­æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ã®ã«å½¹ç«‹ã¤

## iOS16~å¤‰æ›´ç‚¹
### AppTransaction
* Transactionã«é–¢é€£ã™ã‚‹ã‚¹ãƒˆã‚¢ã®æƒ…å ±
* `originalAppVersion: åˆå›è³¼èª­ã—ãŸéš›ã®ã‚¢ãƒ—ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³` ãªã©ãŒå–å¾—ã§ãã‚‹

WWDC22ã®å‹•ç”»ã§ã¯ã€èª²é‡‘ã‚¢ãƒ—ãƒªâ†’ãƒ•ãƒªãƒ¼ãƒŸã‚¢ãƒ ãƒ¢ãƒ‡ãƒ«ã«å¤‰æ›´ã—ãŸã‚¢ãƒ—ãƒªã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èª²é‡‘ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã™ã‚‹ä¾‹ã¨ã—ã¦AppTransactionãŒä½¿ã‚ã‚Œã¦ã„ãŸ
https://developer.apple.com/videos/play/wwdc2022/10007
https://developer.apple.com/documentation/storekit/supporting_business_model_changes_by_using_the_app_transaction

### StoreKitã¸ã®æ–°ã—ã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¿½åŠ 
* Price locale
* Server environment
* Recent subscription start date

ãªã‚“ã¨ã“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ãƒãƒƒã‚¯ãƒãƒ¼ãƒˆã®ã‚µãƒãƒ¼ãƒˆãŒã‚ã‚Šã€Xcode14ã§ãƒ“ãƒ«ãƒ‰ã™ã‚Œã°iOS15, iPadOS15ã§ã‚‚ä½¿ãˆã‚‹
ãŸã ã€iOS15ã®StoreKit Testingã§ã¯ãƒ€ãƒŸãƒ¼ã®å€¤ãŒè¿”ã£ã¦ãã‚‹ã®ã§æ³¨æ„(16ä»¥é™ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ãˆã°è‰¯ã„)

### ã‚¹ãƒˆã‚¢é–¢é€£
SwiftUIã«ã‚ªãƒ•ã‚¡ãƒ¼ã‚³ãƒ¼ãƒ‰ã®å…¥åŠ›, ã‚¹ãƒˆã‚¢ãƒ¬ãƒ“ãƒ¥ãƒ¼APIãŒè¿½åŠ ã«ãªã£ãŸ
StoreKitãƒ¡ãƒƒã‚»ãƒ¼ã‚¸API: å€¤ä¸Šã’ã®é€šçŸ¥ãªã©ã‚¢ãƒ—ãƒªãŒãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«ãªã£ãŸéš›ã«è¡¨ç¤ºã§ãã‚‹

## AppStore Sever APIã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ(WWDC22)
* [Get Transaction History](https://developer.apple.com/documentation/appstoreserverapi/get_transaction_history)
* [Get All Subscription Statuses](https://developer.apple.com/documentation/appstoreserverapi/get_all_subscription_statuses)

Get Transaction Historyã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
* ä¸‹è¨˜ã®ã‚½ãƒ¼ãƒˆ, ãƒ•ã‚£ãƒ«ã‚¿ã‚’ã‹ã‘ã¦å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸ
  * æ›´æ–°æ—¥æ™‚
  * product type, productID, Subscription groupID, Purchase date range, Family sharing status, Exclude revoked transactions

AppStore Server Notification V2
* AppStore Server -> ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒãƒ¼ã®ç–é€šç¢ºèªç”¨ã®ãƒ†ã‚¹ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒç”ŸãˆãŸ
* https://developer.apple.com/documentation/appstoreserverapi/request_a_test_notification
* é€šçŸ¥ãŒæ¥ãªã„å ´åˆã€é€šçŸ¥ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèªã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚‚æ–°è¨­ã•ã‚ŒãŸ
* https://developer.apple.com/documentation/appstoreserverapi/get_test_notification_status

2ã¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¿½åŠ 
* environment: (sandbox or production)
* recentSubscriptionStartDate: æœ€æ–°ã®è³¼èª­æ—¥æ™‚


## è¿”é‡‘(Refund)
document
https://developer.apple.com/documentation/storekit/transaction/3803220-beginrefundrequest
SwiftUI
https://developer.apple.com/documentation/swiftui/view/refundrequestsheet(for:ispresented:ondismiss:)
sample
https://developer.apple.com/documentation/swiftui/food_truck_building_a_swiftui_multiplatform_app

## Tips
Transactionã«å‡¦ç†ãŒæµã‚Œã¦ãã‚‹çŠ¶æ…‹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ãŸã„å ´åˆã€storekit.configã®"Enable Ask to Buy"æ©Ÿèƒ½ã‚’ä½¿ã†ã®ãŒä¾¿åˆ©
(è¦ªã®è¨±å¯ãŒå‡ºã‚‹ã¾ã§èª²é‡‘ã§ããªã„çŠ¶æ…‹ `.pending` çŠ¶æ…‹ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã§ãã¾ã™)
https://developer.apple.com/videos/play/wwdc2021/10114/?time=1039

![](/images/storekit-config.png)

Xcodeã®Transaction Managerã§Ask to Buyã®è¨±å¯ãŒã§ãã¾ã™
![](/images/transaction.png)

:::message
StoreKit2ã§Transaction ManagerãŒå‹•ä½œã—ãªã„ä¸å…·åˆ?ãŒã‚ã‚Šã¾ã™ã€‚
StoreKit.frameworkã‚’ã‚¢ãƒ—ãƒªã«è¿½åŠ ã™ã‚‹ã¨å‹•ä½œã—ã¾ã—ãŸ https://stackoverflow.com/questions/71579782/transaction-manager-not-showing-storekit-2-transactions-in-xcode
:::

## å‚è€ƒã«ã—ãŸè¨˜äº‹ãƒ»å‹•ç”»

document
https://developer.apple.com/documentation/storekit/in-app_purchase
sample
https://developer.apple.com/documentation/storekit/in-app_purchase/implementing_a_store_in_your_app_using_the_storekit_api
revenuecatã®è©³ã—ã„è¨˜äº‹
https://www.revenuecat.com/blog/engineering/ios-in-app-subscription-tutorial-with-storekit-2-and-swift/
WWDC memo
https://www.wwdcnotes.com/notes/wwdc21/10114/

WWDC21: Meet StoreKit 2
https://developer.apple.com/videos/play/wwdc2021/10114
WWDC22: What's new with in-app purchase
https://developer.apple.com/videos/play/wwdc2022/10007
WWDC22: Implement proactive in-app purchase restore
https://developer.apple.com/videos/play/wwdc2022/110404